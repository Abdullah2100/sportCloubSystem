create  database ClubeSportDB

use ClubeSportDB

create table Sports(
sportID int identity(1,1) primary key,
name nvarchar(50) not null,
createdDate datetime default GETDATE(),
isActive bit default 1)

create table SubscriptionTypes(
subscriptionTypeID smallint primary key,
feeMultiplyBy money  not null,
daysNumber smallint
)

create table Nationalitys(
nationalityID int primary key ,
name nvarchar  (20))

create table Peoples(
personIDint identity(1,1) primary key,
fristName nvarchar(20) not null,
secondName nvarchar(20) not null,
thirdName nvarchar(20) not null,
familyName nvarchar(20) not null,
brithday datetime not null,
gender bit not null,
nationalityID int references Nationalitys(nationalityID) ,
address nvarchar(200) not null,
phone nvarchar(15) not null)

Create table Nationality(
nationalityID int identity(1,1) primary key,
name nvarchar(20) not null)


create table People(
personID int identity(1,1) primary key,
fristName nvarchar(20) not null,
secondName nvarchar(20) not null,
thirdName nvarchar(20) not null,
familyName nvarchar(20) not null,
brithday Datetime not null,
gender bit not null,
nationalityID int references Nationalitys(nationalityID),
address nvarchar(200) not null,
phone nvarchar(15) not null
)

create table Members(
memberID int identity(1,1) primary key,
personID int references Peoples(personID),
isActive bit default(1)
)


create table Coaches(
coacheID int identity(1,1) primary key,
personID int references Peoples(personID),
startTraingDate Datetime default getDate(),
endTraingDate Datetime null,
personalImage nvarchar(max)not null,
isActive bit default 1
)

create table CoachesTrainging(
CoachsTraingingID int identity(1,1)primary key,
sportID int not null references Sports(sportID),
isAvaliable bit default 1,
dayilyStartAt nvarchar(10) not null,
dayilyEndAt nvarchar(10) not null,
trainingDay int null,
fee money not null
) 

create table MemberSubscriptions(
memberSubscriptionID int identity(1,1) primary key,
CoachsTraingingID int not null references CoachesTrainging,
memberID int not null references Members,
fee money not null,
startDate datetime  default getDate(),
endDate datetime null)

SELECT ct.CoachsTraingingID, p.fristName + ' ' + p.secondName + ' ' + p.thirdName + ' ' + p.familyName AS fullName, ct.isAvaliable, s.name AS sportName, ct.dayilyStartAt AS startAt, ct.dayilyEndAt AS endAt, CAST(ct.fee AS nvarchar) AS cost
FROM     dbo.CoachesTrainging AS ct INNER JOIN
                  dbo.Coaches AS c ON ct.coacheID = c.coacheID INNER JOIN
                  dbo.Peoples AS p ON p.personID = c.personID INNER JOIN
                  dbo.Sports AS s ON ct.sportID = s.sportID
WHERE  (c.isActive = 1)


SELECT ms.memberSubscriptionID AS subscriptionID, s.name AS sportName,
                      (SELECT fristName + ' ' + secondName + ' ' + thirdName + ' ' + familyName AS Expr1
                       FROM      dbo.Peoples
                       WHERE   (personID = c.personID)) AS coatchName,
                      (SELECT fristName + ' ' + secondName + ' ' + thirdName + ' ' + familyName AS Expr1
                       FROM      dbo.Peoples AS Peoples_1
                       WHERE   (personID = m.personID)) AS memberName, ms.startDate, ms.endDate, c.coacheID, m.memberID
FROM     dbo.MemberSubscriptions AS ms INNER JOIN
                  dbo.CoachesTrainging AS ct ON ms.CoachsTraingingID = ct.CoachsTraingingID INNER JOIN
                  dbo.Coaches AS c ON c.coacheID = ct.coacheID INNER JOIN
                  dbo.Sports AS s ON s.sportID = ct.sportID INNER JOIN
                  dbo.Members AS m ON m.memberID = ms.memberID INNER JOIN
                  dbo.Peoples AS p ON m.personID = p.personID